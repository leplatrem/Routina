webpackJsonp([0],{0:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n(70);var o=n(238),i=r(o),a=n(243),s=n(245),l=r(s),c=n(400),u=r(c),f=n(490),d=n(492),p=r(d);n(554),n(563),n(571);var h=window.location.hash.slice(1);h||(h=window.localStorage.getItem("lastuser")||a.v4(),window.localStorage.setItem("lastuser",h),window.location.hash=h);var m="https://kinto.dev.mozaws.net/v1",b=i["default"](h+":s3cr3t"),y="Basic "+b,v=new p["default"]({remote:m,headers:{Authorization:y}}),g=new f.Store(v,"routina-v1");g.collection.db.dbname=b+g.collection.db.dbname,l["default"].render(l["default"].createElement(u["default"],{store:g,user:h}),document.getElementById("app"))},238:function(e,t,n){(function(t){!function(){"use strict";function n(e){var n;return n=e instanceof t?e:new t(e.toString(),"binary"),n.toString("base64")}e.exports=n}()}).call(t,n(239).Buffer)},400:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;s=c=l=void 0,r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var l=s.get;return void 0===l?void 0:l.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=a,r=!0}},c=n(245),u=r(c),f=n(401),d=r(f),p=n(489),h=function(e){function t(e){i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={record:this.props.record||this.newRoutine()}}return a(t,e),s(t,[{key:"newRoutine",value:function(){return new p.Routine("New task",{value:3,unit:"days"})}},{key:"onFormSubmit",value:function(e){e.preventDefault(),this.props.saveRecord(this.state.record),this.setState({record:this.newRoutine()})}},{key:"onChange",value:function(e,t){var n=t.target.value;switch(e){case"value":n=parseInt(n,10);case"unit":Object.assign(this.state.record.period,o({},e,n));break;default:Object.assign(this.state.record,o({},e,n))}this.setState({record:this.state.record})}},{key:"render",value:function(){var e=this.state.record,t=!e.id;return u["default"].createElement("form",{onSubmit:this.onFormSubmit.bind(this),className:"form-inline fit hbox"},u["default"].createElement("input",{autofocus:!0,name:"label",type:"text",placeholder:"Label",value:e.label,onChange:this.onChange.bind(this,"label"),className:"form-control fit"}),u["default"].createElement("input",{name:"value",type:"number",value:e.period.value,onChange:this.onChange.bind(this,"value"),className:"form-control"}),u["default"].createElement("select",{name:"unit",value:e.period.unit,onChange:this.onChange.bind(this,"unit"),className:"form-control"},p.Routine.units.map(function(e){return u["default"].createElement("option",{value:e},e)})),u["default"].createElement("button",{className:"btn btn-primary submit",type:"submit","aria-label":t?"Add":"Save"},u["default"].createElement("span",{className:"glyphicon glyphicon-"+(t?"plus":"ok"),"aria-hidden":"true"})))}}]),t}(u["default"].Component);t.Form=h;var m=function(e){function t(){i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return a(t,e),s(t,[{key:"onCheck",value:function(){this.props.item.check(),this.props.onSave(this.props.item)}},{key:"render",value:function(){if(this.props.editing)return u["default"].createElement("li",{key:this.props.key,className:"hbox nopad list-group-item"},u["default"].createElement("button",{onClick:this.props.onDelete,className:"btn btn-danger delete","aria-label":"Delete"},u["default"].createElement("span",{className:"glyphicon glyphicon-trash","aria-hidden":"true"})),u["default"].createElement(h,{record:this.props.item,saveRecord:this.props.onSave}));var e=function(e){return e?e.replace(/minutes?/,"min.").replace(/seconds?/,"sec."):""},t=this.props.item,n=d["default"](t.next).fromNow().replace("ago","late"),r=t.last?e(d["default"](t.last).fromNow()):"Never",o=e(t.period.unit);return u["default"].createElement("li",{key:this.props.key,className:t.status+" hbox nopad list-group-item"},u["default"].createElement("button",{onClick:this.onCheck.bind(this),className:"btn check","aria-label":"Check"},u["default"].createElement("span",{className:"glyphicon glyphicon-exclamation-sign","aria-hidden":"true"})),u["default"].createElement("div",null,u["default"].createElement("span",{className:"routine"},t.label),u["default"].createElement("span",{className:"next"},n)),u["default"].createElement("div",{className:"details pull-end"},u["default"].createElement("span",{className:"period"},"Every",u["default"].createElement("span",{className:"value"},t.period.value),u["default"].createElement("span",{className:"unit"},o)),u["default"].createElement("span",{className:"last"},r)),u["default"].createElement("button",{onClick:this.props.onEdit,className:"btn default edit","aria-label":"Edit"},u["default"].createElement("span",{className:"glyphicon glyphicon-pencil","aria-hidden":"true"})))}}],[{key:"defaultProps",get:function(){return{onEdit:function(){},onDelete:function(){},onSave:function(){}}}}]),t}(u["default"].Component);t.Item=m;var b=function(e){function t(e){i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={}}return a(t,e),s(t,null,[{key:"defaultProps",get:function(){return{editItem:function(){},updateRecord:function(){},deleteRecord:function(){}}}}]),s(t,[{key:"onEdit",value:function(e){this.setState({current:e}),this.props.editItem(e)}},{key:"onSave",value:function(e){this.setState({current:null}),this.props.updateRecord(e)}},{key:"onDelete",value:function(e){this.setState({current:null}),this.props.deleteRecord(e)}},{key:"render",value:function(){var e=this;return u["default"].createElement("ul",{className:"list-group"},this.props.items.map(function(t,n){return u["default"].createElement(m,{key:n,item:t,editing:n===e.state.current,onEdit:e.onEdit.bind(e,n),onDelete:e.onDelete.bind(e,t),onSave:e.onSave.bind(e)})}))}}]),t}(u["default"].Component);t.List=b;var y=function(e){function t(e){var n=this;i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state=this.props.store.state,this.props.store.on("change",function(e){n.props.store.autorefresh=!0,n.setState(Object.assign({busy:!1},e))}),this.props.store.on("error",function(e){n.props.store.autorefresh=!0,n.setState({busy:!1,error:e.message})}),this.props.store.load(),this.props.user&&this.syncRecords()}return a(t,e),s(t,[{key:"editItem",value:function(){this.props.store.autorefresh=!1}},{key:"createRecord",value:function(e){this.props.store.create(e)}},{key:"deleteRecord",value:function(e){this.props.store["delete"](e)}},{key:"updateRecord",value:function(e){this.props.store.update(e)}},{key:"syncRecords",value:function(){this.setState({busy:!0,error:""}),this.props.store.sync()}},{key:"render",value:function(){var e=this.state.busy?"disabled":"";return u["default"].createElement("section",{className:e},u["default"].createElement("div",{className:"error"},this.state.error),u["default"].createElement(b,{editItem:this.editItem.bind(this),updateRecord:this.updateRecord.bind(this),deleteRecord:this.deleteRecord.bind(this),items:this.state.items}),u["default"].createElement("div",{className:"hbox create"},u["default"].createElement(h,{saveRecord:this.createRecord.bind(this)})),u["default"].createElement("div",{className:"hbox"},u["default"].createElement("button",{className:"btn default sync fit","data-icon":"sync",onClick:this.syncRecords.bind(this),disabled:e},u["default"].createElement("span",{className:"glyphicon glyphicon-cloud-upload","aria-hidden":"true"}),"Â Sync"),u["default"].createElement("a",{href:"https://leplatrem.github.io/Routina/#"+this.props.user},u["default"].createElement("span",{className:"glyphicon glyphicon-link","aria-hidden":"true"}),"Permalink")))}}]),t}(u["default"].Component);t["default"]=y},489:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(401),s=r(a),l=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o(this,e),this.label=t,this.period=n,this.occurences=[]}return i(e,[{key:"serialize",value:function(){var e=Object.assign({},this);return e.occurences=e.occurences.map(function(e){return e.toISOString()}),e}},{key:"check",value:function(){this.occurences.push(new Date)}},{key:"_period",get:function(){return s["default"].duration(this.period.value,this.period.unit)}},{key:"status",get:function(){var t=this._period.as("seconds"),n=.1*t;return this.timeleft<-t?e.status.CRITICAL:this.timeleft<-n?e.status.OVERDUE:this.timeleft<n?e.status.WARNING:e.status.OK}},{key:"elapsed",get:function(){return s["default"]().diff(s["default"](this.last),"seconds")}},{key:"timeleft",get:function(){return s["default"](this.next).diff(s["default"](),"seconds")}},{key:"last",get:function(){return this.occurences[this.occurences.length-1]}},{key:"next",get:function(){return s["default"](this.last).add(this._period).toDate()}}],[{key:"deserialize",value:function(t){var n=new e;return Object.assign(n,t),n.occurences=n.occurences.map(function(e){return new Date(e)}),n}},{key:"status",get:function(){return{OK:"ok",WARNING:"warning",OVERDUE:"overdue",CRITICAL:"critical"}}},{key:"units",get:function(){return["seconds","minutes","hours","days","months","years"]}}]),e}();t.Routine=l},490:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;s=c=l=void 0,r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var l=s.get;return void 0===l?void 0:l.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=a,r=!0}},s=n(491),l=n(489),c=function(e){function t(e,n){r(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.state={items:[]},this.collection=e.collection(n)}return o(t,e),i(t,[{key:"deserialize",value:function(e){return l.Routine.deserialize(e)}},{key:"serialize",value:function(e){return e.serialize()}},{key:"onError",value:function(e){this.emit("error",e)}},{key:"emitChange",value:function(){this.state.items.sort(function(e,t){return e.timeleft-t.timeleft});this.emit("change",this.state)}},{key:"load",value:function(){var e=this;return this.collection.list().then(function(t){var n=t.data.map(e.deserialize);e.state.items=n,e.emitChange()})["catch"](this.onError.bind(this))}},{key:"create",value:function(e){var t=this;return this.collection.create(this.serialize(e)).then(function(e){var n=t.deserialize(e.data);t.state.items.push(n),t.emitChange()})["catch"](this.onError.bind(this))}},{key:"update",value:function(e){var t=this;return this.collection.update(this.serialize(e)).then(function(n){t.state.items=t.state.items.map(function(r){var o=t.deserialize(n.data);return r.id===e.id?o:r}),t.emitChange()})["catch"](this.onError.bind(this))}},{key:"delete",value:function(e){var t=this;return this.collection["delete"](e.id).then(function(n){t.state.items=t.state.items.filter(function(t){return t.id!==e.id}),t.emitChange()})["catch"](this.onError.bind(this))}},{key:"sync",value:function(){var e=this;return this.collection.sync().then(function(t){return t.ok?e.load():Promise.all(t.conflicts.map(function(t){return e.collection.resolve(t,t.remote)})).then(function(t){return e.sync()})})["catch"](this.onError.bind(this))}},{key:"autorefresh",set:function(e){e?this._timer||(this._timer=setInterval(this.emitChange.bind(this),5e3)):this._timer&&(this._timer=clearInterval(this._timer))},get:function(){return!!this._timer}}]),t}(s.EventEmitter);t.Store=c},563:function(e,t,n){var r=n(564);"string"==typeof r&&(r=[[e.id,r,""]]);n(562)(r,{});r.locals&&(e.exports=r.locals)},564:function(e,t,n){t=e.exports=n(556)(),t.push([e.id,"@font-face{font-family:Fira Sans;src:url("+n(565)+");src:local('Fira Sans Regular'),url("+n(566)+") format('woff'),url("+n(567)+") format('woff2');font-weight:400;font-style:normal}@font-face{font-family:Fira Sans;src:url("+n(568)+");src:local('Fira Sans Bold'),url("+n(569)+") format('woff'),url("+n(570)+") format('woff2');font-weight:700;font-style:normal}",""])},565:function(e,t,n){e.exports=n.p+"24072a8021ae9031e702cc98d0b970ef.eot"},566:function(e,t,n){e.exports=n.p+"ba1f3bb83d99f39922a59d9fc74f5997.woff"},567:function(e,t,n){e.exports=n.p+"0ed10407356f296980956152c097d932.woff2"},568:function(e,t,n){e.exports=n.p+"fddeb422f43b78c998446318024f9e48.eot"},569:function(e,t,n){e.exports=n.p+"6098762daee4e4f41d01d53e4f88bcfc.woff"},570:function(e,t,n){e.exports=n.p+"299cd657b16b0d7f9cb1cd890e935a9d.woff2"},571:function(e,t,n){var r=n(572);"string"==typeof r&&(r=[[e.id,r,""]]);n(562)(r,{});r.locals&&(e.exports=r.locals)},572:function(e,t,n){t=e.exports=n(556)(),t.push([e.id,'body,html{width:100%;padding:0;margin-bottom:4px;font-family:Fira Sans}.btn.default{background-color:transparent;border-color:#ddd}.disabled{color:GrayText}.error{color:red}.hbox{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.hbox>*,.hbox>:first-child{margin-left:4px}.hbox>:last-child{margin-right:4px}.nopad{padding-left:0;padding-right:0}.fit{flex-grow:1}.pull-end{margin-left:auto}li.hbox{align-items:stretch}li.ok button.check{box-shadow:inset 4px 0 0 0 green;background-color:rgba(0,128,0,.2);color:green}li.warning button.check{box-shadow:inset 4px 0 0 0 #ffd800;background-color:rgba(255,216,0,.2);color:#ffd800}li.overdue button.check{box-shadow:inset 4px 0 0 0 #ff7e00;background-color:rgba(255,126,0,.2);color:#ff7e00}li.critical button.check{box-shadow:inset 4px 0 0 0 #d70000;background-color:rgba(215,0,0,.2);color:#d70000}li .routine{font-size:1.2em;font-weight:700}li .next{color:#888;padding-left:2px;display:block}li .details{align-self:center}li .details>span{display:block;width:100%;text-align:center}li .details .last{color:#888}li .details .last:before{content:"("}li .details .last:after{content:")"}li .details .period .unit:before,li .details .period .value:before{content:"\\A0"}.create{margin-bottom:20px;padding-left:4px;padding-right:4px}.create form{padding:4px 0;border-radius:4px;border:1px solid #ddd}form.hbox,form.hbox:last-child{margin:0}form .form-control{margin-left:4px;padding:6px 3px}form input[name=label]{min-width:0;display:inline}form input[name=value]{max-width:4em}form button[type=submit]{margin-left:4px}',""])}});